{% extends "layout.html" %}


{% block title %}
<div class="header-content" data-0="height:100px" data-150="height:0px">
    <div class="top-header">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-12">
                     <h1 data-0="margin-top:25px;font-size:3em;" data-150="margin-top:-55px;font-size:2em;">
                        {{plugin.label}}
                        <small style="color:rgba(255,255,255,0.7);font-weight:300;">
                            Version {{plugin.version.major}}.{{plugin.version.minor}}
                        </small>
                    </h1>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}


{% block subtitle %}
<div class="bottom-header">
    <div class="navbar navbar-default">
        <div class="navbar-collapse collapse navbar-responsive-collapse-filter">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-12">
                        <a href="/plugin"><i class="fa fa-angle-left"></i> Back to all plugins</a>
                        {% if "OfxImageEffectPropSupportedContexts" in plugin.properties %}
                            {% set supportedContexts = plugin.properties.OfxImageEffectPropSupportedContexts.propValues %}
                            {% if "OfxImageEffectContextFilter" in supportedContexts or
                               "OfxImageEffectContextGenerator" in supportedContexts
                               %}
                                <a href="/editor/{{plugin.rawIdentifier}}" class="btn btn-primary btn-render-navbar">
                                    <i class="fa fa-rocket" style="padding-right: 7px"></i>
                                    Live demo of
                                    <span class="calltolive">{{ plugin.shortLabel }}</span>
                                </a>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}


{% block content %}
<div class="main-content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="page-header">
                <h2>Edit {{plugin.label}} wiki</h2>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <form>
                       <textarea id="wiki" class="panel panel-primary" data-provide="markdown" data-iconlibrary="fa" rows="10">{{plugin.wiki | last}}</textarea>
                       <input type='submit' value='Save' id="setWiki" class="btn btn-primary" attr-id="{{plugin.id}}">
                </form>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="page-header">
                    <h3>Preview :</h3>
                    <span id="mkdwn">
                        {{ plugin.wiki | last }}
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script type="text/javascript">
$(document).ready(function() {

    function wikiJson()
    {
        $.ajax({
            type: "POST",
            url: "/wiki/update/"+{{plugin.pluginId}},
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify({
                'wikicontent': '\n' + $("#wiki").val()
            }),
        })
    }

    $("#setWiki").click(function(){
        wikiJson();
    });
});
</script>
<script type="text/javascript">
/*
$('#wiki').markdown({
    hiddenButtons:'cmdPreview',
    footer:'<div id="twitter-footer" class="well" style="display:none"></div>',
    onChange:function(e){
        var content = e.parseContent();
        $('#twitter-footer').show().html(content);
    }
})*/
var s = $("#mkdwn").html();
    s = "\n\n\n" + s + "\n\n\n";
var rend = markdown.toHTML(s);
//$("#mkdwn").html(s);
$("#mkdwn").html(rend);
</script>
{% endblock %}
